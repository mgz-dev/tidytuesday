---
title: "Tidy Tuesday Freedom Dataset"
author: "M. Zhang"
date: "2022-03-01"
output:
  html_document:
    df_print: tibble
    toc: yes
  pdf_document:
    toc: yes
---

```{r, setup, include=FALSE}
library(tidyverse)
library(colorspace)
library(ggforce)
library(ggridges)
knitr::opts_chunk$set(echo = TRUE, comment = "")
```

# Introduction

We will be working with the `freedom.csv` dataset via the Tidy Tuesday repository. This analysis will not be styled as a "final report", but rather as a quick walk through of some data analysis and wrangling that took place while exploring the data.

The MSDSO Discord group for the University of Texas Masters in Data Science Online program will be doing weekly explorations of TidyTuesday as an exercise for improving their data science skill sets in a collaborative environment.

## Data Details

This dataset is pulled from the Tidy Tuesday Repository:

Thomas Mock (2022). Tidy Tuesday: A weekly data project aimed at the R ecosystem. https://github.com/rfordatascience/tidytuesday.

The original data is from [Freedom House](https://freedomhouse.org/reports/publication-archives) and the [United Nations](https://unstats.un.org/unsd/methodology/m49/overview/)via [Arthur Cheib](https://github.com/ArthurCheib/analytical-politics-project/blob/main/data/tidy-data-fh-un.csv).

Freedom House is a nonpartisan organization focused on producing research and reports on themes and trends related to democracy, political rights, and civil liberties. This data set `freedom` contains information in regards to various country's Civil Liberty `CL` and Political Rights `PR` index scores, as well as their Least Developed Country `LDC` indicator.

## Data Loading

```{r, load-data, message = FALSE}
freedom <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-02-22/freedom.csv')
```


## Data Dictionary

The following tables contain information in regards to the columns available.

`freedom.csv`

|variable    |class     |description |
|:-----------|:---------|:-----------|
|country     |character | Country Name |
|year        |double    | Year |
|CL          |double    | Civil Liberties |
|PR          |double    | Political rights |
|Status      |character | Status (Free `F`, Not Free `NF`, Partially Free `PF`) |
|Region_Code |double    | UN Region code |
|Region_Name |character | UN Region Name |
|is_ldc      |double    | Is a least developed country (binary 0/1) |

The definition for "Least Developed Country" is pulled from the [United Nations](https://www.un.org/ohrlls/content/ldc-category). A country qualifies for LDC if it meets the criteria for Income, Human Assets, and Economic and Environmental Vulnerability. An important requirement for inclusion is that the country must agree to the classification to be added to the list.

The Civil Liberties and Political Rights score is generated by FreedomHouse, using a methodology inspired by the Universal Declaration of Human Rights which was adopted by the UN General Assembly in 1948, The Civil Liberties score is a combination of 15 separate indicators, and Political Rights score is a combination of 10 separate indicators. Each of these indicators scale from 0 to 4, with 4 representing the greatest amount of freedom. These scores are summarized into indexes for Civil Liberties `CL` and Political Rights `PR` on a scale from 1 to 7, with 1 representing the greatest freedom.

`Status` buckets the combined `CL` and `PR` scores into 3 general categories: Free, Partially Free, and Not Free.

Additional details are available [here](https://freedomhouse.org/reports/freedom-world/freedom-world-research-methodology).

# Data Exploration and wrangling

## Examining the raw data

We will initially take a precursor inspection of the data, utilizing `summary` for numerical information and `table` for categorical information.

```{r, cursory-inspection}
glimpse(freedom)
names(freedom)

freedom %>%
  select(CL, PR, is_ldc) %>% 
  summary(freedom)

freedom %>%
  count(country) %>%
  arrange(n)

freedom %>% select(year) %>% table(useNA = "ifany")
freedom %>% select(Status) %>% table(useNA = "ifany")
freedom %>% select(Region_Code) %>% table(useNA = "ifany")
freedom %>% select(Region_Name) %>% table(useNA = "ifany")
freedom %>% select(is_ldc) %>% table(useNA = "ifany")
  
```

We can see that it appears that not all countries have full data for all 26 years. We will filter and examine a specific country to see if the missing years are sequential:

```{r, years}
freedom %>%
  filter(country == "South Sudan") %>%
  select(year) %>% pull()
```

A precursory glance suggest that not all countries have the full year range of data. There are no unexpected unique values from our initial look at the data. Additionally, the `PR` and `CL` scores are within the expected ranges given the definitions provided by FreedomHouse.

## Checking for NA values

```{r, examine_na}
freedom %>%
  summarize(across(everything(), ~ sum(is.na(.)))) %>%
  tidyr::pivot_longer(everything()) %>%
  arrange(desc(value)) %>% 
  deframe()
```

NA counting methodology was taken from [stackexchange](https://stackoverflow.com/questions/63198917/using-tidyverse-pipeline-to-count-nas-and-reorder)

It appears that there are no NA values in this data set. This is reaffirming our findings from when we checked the summary and tables for the dataset earlier.

## Recoding

Going forward, we will be using the `Region_Name` column in lieu of `Region_Code` for simplicity. Additionally, we will recode `is_ldc` into categorical values. 

```{r, recode}
freedom = freedom %>% 
  mutate(ldc = if_else(is_ldc == 1, "Yes", "No"))

freedom %>%
  select(is_ldc, ldc) %>% unique()
```

## Grouping candidates

Let's examine the total number of unique entries per column to see good candidates for faceting or other categorization methods.

```{r}
freedom %>%
  sapply(n_distinct)
```

We can see that `LDC`, `Status` and `Region_Name` are all potential ways to cluster data.


## Developing Questions

While examining the data set, the following potential questions arose for investigation:

1. How have the 5 of the best, and 5 of worst non LDC countries shifted in terms of freedom from 1995 to 2020?
2. How are proportions of Free, Partially Free, and Not Free countries shifting over time?
3. How are the distribution of Political Rights, and Civil Liberties fluctuating over time by region?

For the first question, we will need to set criteria for "worst" and "best", and then identify these countries. We will use a combined `PR + CL` score as the gauge of measure. A score of 14 would represent "worst" and 2 would represent "best". We will also exclude countries that do not have data for all years.

```{r, best-worst}
 freedom = freedom %>% 
  mutate(PR_CL = PR + CL)

freedom %>%
  filter(year == 1995, ldc == "No") %>%
  select(country, Region_Name, ldc, PR_CL) %>%
  arrange(PR_CL) %>% head(20)

freedom %>%
  filter(year == 1995, ldc == "No") %>%
  select(country, Region_Name, ldc, PR_CL) %>%
  arrange(desc(PR_CL)) %>% head(20)

freedom %>%
  filter(year == 1995, ldc == "No", PR_CL == 2) %>%
  arrange(PR_CL) %>% 
  select(country) %>%
  pull()

freedom %>%
  filter(year == 1995, ldc == "No", PR_CL == 14) %>%
  arrange(PR_CL) %>% 
  select(country) %>%
  pull()

exclude_list <- freedom %>%
  group_by(country) %>%
  summarize(n = n()) %>%
  filter(n != 26) %>%
  select(country) %>% pull()
exclude_list
```

A look at the data showed that there was not enough granularity in the scale to determine soley based off the data, thus we chose the following 5 countries based off interest and recent political events.

```{r, best-worst-list}

best_list <- c("Australia", "Canada", "Belgium", "Iceland", "United States of America")
worst_list <- c("China", "Iraq", "Nigeria", "Saudi Arabia", "Viet Nam")
choice_list <-c("Russian Federation", "Ukraine", "Qatar", "Afghanistan", "Rwanda")
best_list
worst_list

```


# Data Visualizations

Pairwise plot for data - check raw data
```{r, pairplots-1, fig.width = 10, fig.height = 8}
freedom %>%
  select(year, CL, PR, is_ldc, PR_CL) %>%
  pairs()

```

Check grouped data 

```{r, pairplots-2, fig.width = 10, fig.height = 8}
freedom %>%
  group_by(year) %>%
  summarize(mean_CL = mean(CL), mean_PR = mean(PR), mean_ldc = mean(is_ldc), n = n()) %>%
  select(year, mean_CL, mean_PR, mean_ldc, n) %>%
  pairs()

```


## Trends for top and worst 5, and choice

```{r, plot-1, fig.width = 10, fig.height = 8}
freedom %>%
  filter(country %in% best_list) %>%
  pivot_longer(cols = c("PR", "CL"), names_to = "Label", values_to = "Score") %>%
  ggplot() + 
  aes(x = factor(year), y = Score, fill = Label) + 
  facet_wrap(
    vars(country),
    ncol = 1) + 
  geom_col(position = "dodge") + 
  scale_y_continuous(
    limit = c(0, 7)) +
  scale_x_discrete(
    name = "Year",
    labels = factor(seq(from = 1995, to = 2020, by = 2)),
    breaks = factor(seq(from = 1995, to = 2020, by = 2))) +
  scale_fill_manual(values = c(CL = "#E69F00", PR = "#0072B2")) +
  theme_classic()

freedom %>%
  filter(country %in% worst_list) %>%
  pivot_longer(cols = c("PR", "CL"), names_to = "Label", values_to = "Score") %>%
  ggplot() + 
  aes(x = factor(year), y = Score, fill = Label) + 
  facet_wrap(
    vars(country),
    ncol = 1) + 
  geom_col(position = "dodge") + 
  scale_y_continuous(
    limit = c(0, 7)) +
  scale_x_discrete(
    name = "Year",
    labels = factor(seq(from = 1995, to = 2020, by = 2)),
    breaks = factor(seq(from = 1995, to = 2020, by = 2))) +
  theme_classic()

freedom %>%
  filter(country %in% choice_list) %>%
  pivot_longer(cols = c("PR", "CL"), names_to = "Label", values_to = "Score") %>%
  ggplot() + 
  aes(x = factor(year), y = Score, fill = Label) + 
  facet_wrap(
    vars(country),
    ncol = 1) + 
  geom_col(position = "dodge") + 
  scale_y_continuous(
    limit = c(0, 7)) +
  scale_x_discrete(
    name = "Year",
    labels = factor(seq(from = 1995, to = 2020, by = 2)),
    breaks = factor(seq(from = 1995, to = 2020, by = 2))) +
  theme_classic()

```

Unfortunately, these plots ended up poor visually. There was also limited movement in the metrics. We could speculate that maybe those with the highest and lowest freedom scores are most "stable" in regards to the operations of their current regime form. A notable exception among those countries scoring "high" in freedom is the U.S., in which this metric shows a decline in freedom starting in 2017.

## Overall trends in freedom over time

```{r, plot-2, fig.width = 10, fig.height = 10}
status_colors = c("#56B4E9", "#D55E00", "#000000")

freedom %>%
  filter(!country %in% exclude_list) %>%
  ggplot() + 
  aes(x = year, fill = factor(Status, levels =c("F", "PF", "NF"))) +
  geom_bar(position = "fill") + 
  facet_wrap(
  vars(Region_Name),
  ncol = 1)  +
  scale_fill_manual(
    name = "",
    values = status_colors,
    breaks = c("F", "PF", "NF"),
    labels = c("Free", "Partially Free", "Not Free")) +
  theme_classic()
```

```{r, plot-2-total, fig.width = 10, fig.height = 4}
freedom %>%
  filter(!country %in% exclude_list) %>%
  ggplot() + 
  aes(x = year, fill = factor(Status, levels =c("F", "PF", "NF"))) +
  geom_bar(position = "fill") + 
  scale_fill_manual(
    name = "",
    values = status_colors,
    breaks = c("F", "PF", "NF"),
    labels = c("Free", "Partially Free", "Not Free")) +
  ggtitle("Overall") + 
  theme_classic()

```


## Overall trends in freedom over time by region

```{r, plot-3, fig.width = 10, fig.height = 10}
freedom %>%
  filter(!country %in% exclude_list) %>%
  ggplot() + 
  aes(x = factor(year), y = PR_CL) +
  geom_boxplot() + 
  facet_wrap(
    vars(Region_Name),
    ncol = 1) + 
  theme_classic()

```


# Conclusion

This data set was fairly clean and had a large amount of pre-processing completed on it. My impression is that it would have been better to have supplied the raw indicator scores which composed the CL and PR metrics. As can be seen in the "Top 5" and "Worst 5" bar charts, the level of granularity provided gives minimal year by year changes.

This is a good data set for practicing basic data cleaning (recoding, mutates, filtering, etc). 
